<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Tic-Tac-Time | 4D Multiplayer</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app">
    <div id="toast" class="toast hidden"></div>
    
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <button id="headerLeaveBtn" class="btn-header hidden">‚Üê Leave</button>
        </div>
        <h1 class="header-title">üéÆ Tic-Tac-Time</h1>
        <div class="header-right">
          <div id="headerTimer" class="header-timer hidden">
            <span class="timer-label">Time:</span>
            <span id="headerTimerDisplay" class="timer-display">15</span>
          </div>
          <div id="userDisplay" class="user-display hidden"></div>
        </div>
      </div>
    </header>

    <!-- Auth Modal (global) -->
    <div id="authModal" class="auth-modal hidden">
      <div class="modal-content">
        <button id="closeModal" class="close-btn">√ó</button>
        <h3 id="modalTitle">Login</h3>
        <div id="loginForm" class="auth-form">
          <input type="email" id="loginEmail" placeholder="Email" class="input">
          <input type="password" id="loginPassword" placeholder="Password" class="input">
          <button id="loginBtn" class="btn btn-primary">Login</button>
          <div class="auth-switch">
            <span>Don't have an account?</span>
            <a href="#" id="switchToSignup">Sign up</a>
          </div>
        </div>
        <div id="signupForm" class="auth-form hidden">
          <input type="text" id="signupName" placeholder="Name" class="input">
          <input type="email" id="signupEmail" placeholder="Email" class="input">
          <input type="password" id="signupPassword" placeholder="Password" class="input">
          <button id="signupBtn" class="btn btn-primary">Sign Up</button>
          <div class="auth-switch">
            <span>Already have an account?</span>
            <a href="#" id="switchToLogin">Log in</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Room Modal -->
    <div id="createRoomModal" class="auth-modal hidden">
      <div class="modal-content">
        <button id="cancelCreateRoom" class="close-btn" title="Close">√ó</button>
        <h3>Create Room</h3>
        <div class="auth-form">
          <input type="text" id="roomName" class="input" placeholder="Room name (e.g., Chill Match)" maxlength="40">

          <div class="toggle-row">
            <span class="toggle-label">Password protect room</span>
            <label class="toggle">
              <input type="checkbox" id="roomPasswordProtected">
              <span class="toggle-track"><span class="toggle-thumb"></span></span>
            </label>
          </div>

          <input type="password" id="roomPassword" class="input hidden" placeholder="Password" disabled>

          <div class="modal-actions">
            <button id="confirmCreateRoom" class="btn btn-primary">Create</button>
            <button id="cancelCreateRoomBtn" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile/Settings Modal -->
    <div id="profileModal" class="auth-modal hidden">
      <div class="modal-content">
        <button id="closeProfileModal" class="close-btn">√ó</button>
        <h3>Profile</h3>
        <div class="auth-form" style="margin-bottom: 1rem;">
          <div id="profileName"></div>
          <div id="profileEmail" style="color: var(--text-dim);"></div>
        </div>
        <h4 style="margin: 0 0 0.75rem;">Settings</h4>
        <div class="auth-form" style="margin-bottom: 1rem;">
          <label><input type="checkbox" id="settingReducedMotion"> Reduced motion</label>
          <label><input type="checkbox" id="settingHighGraphics"> High graphics</label>
          <label><input type="checkbox" id="settingSound"> Sound</label>
        </div>
        <button id="logoutConfirmBtn" class="btn btn-secondary">Logout</button>
      </div>
    </div>

    <!-- Landing Page -->
    <div id="auth" class="screen landing">
      <div class="landing-content">
        <h1 class="landing-title">Tic-Tac-Time</h1>
        <p class="landing-subtitle">3D Tic-Tac-Toe with Time Travel</p>

        <div class="landing-buttons">
          <button id="singlePlayerQuickBtn" class="landing-btn landing-btn-primary">
            <span class="btn-label">Play vs AI</span>
          </button>

          <button id="multiplayerQuickBtn" class="landing-btn landing-btn-secondary">
            <span class="btn-label">Multiplayer</span>
          </button>

          <button id="localMultiplayerBtn" class="landing-btn">
            <span class="btn-label">Local Multiplayer</span>
          </button>
        </div>

        <div class="landing-footer">
          <button id="showLoginBtn" class="text-link">Login</button>
          <span class="separator">¬∑</span>
          <button id="showSignupBtn" class="text-link">Sign Up</button>
        </div>
      </div>
    </div>

    

    <!-- Mode Selection -->
    <div id="modeSelect" class="screen hidden">
      <div class="screen-content">
        <h2>Choose Game Type</h2>
        <div class="option-grid" id="gameTypeGrid">
          <button class="option-card" data-game-mode="normal">
            <span class="btn-title">üéØ Normal Mode</span>
            <span class="btn-desc">Classic 3D Tic-Tac-Toe</span>
          </button>
          <button class="option-card" data-game-mode="time">
            <span class="btn-title">‚è∞ Fight Across Time</span>
            <span class="btn-desc">4D with time travel mechanics</span>
          </button>
        </div>
        <button id="backFromMode" class="btn btn-secondary">Back</button>
      </div>
    </div>

    <!-- AI Difficulty Selection -->
    <div id="aiDifficulty" class="screen hidden">
      <div class="screen-content">
        <h2>Choose Difficulty</h2>
        <button class="btn btn-primary" data-difficulty="easy">
          <span class="btn-title">üòä Easy</span>
          <span class="btn-desc">Beginner friendly</span>
        </button>
        <button class="btn btn-primary" data-difficulty="medium">
          <span class="btn-title">üß† Medium</span>
          <span class="btn-desc">Balanced challenge</span>
        </button>
        <button class="btn btn-primary" data-difficulty="hard">
          <span class="btn-title">üí™ Hard</span>
          <span class="btn-desc">Tough opponent</span>
        </button>
        <button class="btn btn-primary" data-difficulty="impossible">
          <span class="btn-title">üëπ Impossible</span>
          <span class="btn-desc">Unbeatable AI</span>
        </button>
        <button id="backFromDifficulty" class="btn btn-secondary">Back</button>
      </div>
    </div>

    <!-- Lobby -->
    <div id="lobby" class="screen hidden">
      <div class="screen-content">
        <h2>Online Lobbies</h2>
        <div class="lobby-actions">
          <input id="lobbySearch" class="input" placeholder="Search lobbies">
          <div class="join-code-row">
            <input id="joinCodeInput" class="input" placeholder="Enter room code">
            <input id="joinPasswordInput" class="input" placeholder="Password (if required)">
            <button id="joinByCodeBtn" class="btn btn-secondary btn-small">Join</button>
          </div>
        </div>
        <div id="lobbyList" class="lobby-list">
          <p class="loading">Finding games...</p>
        </div>
        <div class="lobby-footer">
          <button id="createLobby" class="btn btn-primary">Create Room</button>
          <button id="refreshLobbies" class="btn btn-secondary">Refresh</button>
          <button id="backFromLobby" class="btn btn-secondary">Back</button>
        </div>
      </div>
    </div>

    <!-- Room -->
    <div id="room" class="screen hidden">
      <div class="screen-content">
        <h2>Waiting Room</h2>
        <div class="room-info">
          <div class="code-row">
            <input id="roomCode" class="input" readonly>
            <button id="copyRoomCode" class="btn btn-secondary btn-small">Copy Code</button>
          </div>
          <div class="code-row">
            <input id="roomLink" class="input" readonly>
            <button id="copyRoomLink" class="btn btn-secondary btn-small">Copy Link</button>
          </div>
          <div id="roomPlayers" style="margin: 1.5rem 0; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-weight: 600; color: #4CAF50;">üéÆ Host:</span>
                <span id="player1Name" style="color: var(--text-bright);">Waiting...</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-weight: 600; color: #2196F3;">üë§ Guest:</span>
                <span id="player2Name" style="color: var(--text-dim);">Waiting for opponent...</span>
              </div>
            </div>
          </div>
          <p class="loading">Waiting for opponent...</p>
        </div>
        <button id="startGame" class="btn btn-primary hidden">Start</button>
        <button id="cancelRoom" class="btn btn-secondary">Cancel</button>
      </div>
    </div>

    <!-- Game -->
    <div id="game" class="game hidden">
      <div class="game-info">
        <div class="player-status">
          <span id="currentPlayerDisplay">Current Player: <strong>X</strong></span>
          <span id="gameModeDisplay"></span>
        </div>
        <div id="timeControls" class="time-controls hidden">
          <button id="prevTime" class="btn-time">‚Üê Past</button>
          <span id="timeDisplay">Present (T2)</span>
          <button id="nextTime" class="btn-time">Future ‚Üí</button>
        </div>
      </div>

      <div id="canvas-container"></div>
      
      <!-- View-Only Restart Bar (shown after Back to Board) -->
      <div id="viewOnlyBar" class="hidden" style="position: absolute; left: 0; right: 0; bottom: 18px; display: flex; justify-content: center; pointer-events: none;">
        <button id="restartFromView" class="btn btn-primary" style="pointer-events: auto;">Play Again</button>
      </div>
      
      <!-- Move Confirmation Panel -->
      <div id="confirmPanel" class="confirm-panel hidden">
        <p>Place <strong id="confirmPlayer">X</strong> here?</p>
        <div class="confirm-buttons">
          <button id="confirmMove" class="btn btn-primary">‚úì Confirm</button>
          <button id="cancelMove" class="btn btn-secondary">‚úó Cancel</button>
        </div>
      </div>
      
      <!-- View Control Arrows -->
      <div class="view-controls">
        <button id="viewTop" class="view-btn view-btn-top" title="Top View">‚Üë</button>
        <button id="viewLeft" class="view-btn view-btn-left" title="Left View">‚Üê</button>
        <button id="viewRight" class="view-btn view-btn-right" title="Right View">‚Üí</button>
        <button id="viewBottom" class="view-btn view-btn-bottom" title="Bottom View">‚Üì</button>
      </div>
      
      <div id="status" class="status"></div>
    </div>

    <!-- Game Over -->
    <div id="gameOver" class="game-over hidden">
      <div class="game-over-content">
        <h2 id="winnerText"></h2>
        <button id="playAgain" class="btn btn-primary">Play Again</button>
        <div style="height: 0.5rem;"></div>
        <button id="backToBoard" class="btn btn-secondary">Back to Board (View Only)</button>
        <div style="height: 0.5rem;"></div>
        <button id="mainMenuBtn" class="btn btn-secondary">Main Menu</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
